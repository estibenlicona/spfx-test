define("8e65ac45-8617-4f1d-86f1-7f98f772a17e_0.0.1",["@microsoft/sp-core-library","@microsoft/sp-application-base"],(e,t)=>(()=>{"use strict";var n={841:e=>{e.exports=t},676:t=>{t.exports=e}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={exports:{}};return n[e](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{i.r(r),i.d(r,{default:()=>b});var e,t,n=i(676),a=i(841),o={ALLOWED_ORIGINS:["https://widget01.wolkvox.com","https://widget02.wolkvox.com"],DEFAULT_BASE_URL:"https://widget01.wolkvox.com/chat/",DEFAULT_OPERATION:"VUVPQmNNRTI5YnlqQ0pNenZoeGhVMVBKV2lPYUVwM3hwZmQ3VFZ6cERJMD0=",DEFAULT_ID_CONFIG:"RkRoSFFlZTRCeHVQUHdWd3lpTjhRQT09",INIT_DELAY_MS:500,RETRY_DELAY_MS:1e3,THROTTLE_INTERVAL_MS:1e3,MAX_TITLE_LENGTH:100,MAX_DIMENSION_PX:2e3,IFRAME_Z_INDEX:99999},s={l:{height:"73px",width:"75px"},m:{height:"55px",width:"60px"},s:{height:"45px",width:"50px"},custom:{height:"120px",width:"120px"}},c="resize::",d="title",l="WolkvoxChatApplicationCustomizer",u="wolkvoxIframe",f=(e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}),p="undefined"!=typeof window&&"localhost"===window.location.hostname,m=function(e){function t(t,n,a){var i=e.call(this,t)||this;return i.code=n,i.originalError=a,i.name="WolkvoxError",a&&a.stack&&(i.stack=a.stack),i}return f(t,e),t}(Error);!function(e){e.IFRAME_NOT_FOUND="IFRAME_NOT_FOUND",e.IFRAME_CONTENT_WINDOW_NOT_READY="IFRAME_CONTENT_WINDOW_NOT_READY",e.INIT_POSTMESSAGE_FAILED="INIT_POSTMESSAGE_FAILED",e.INIT_THROTTLED="INIT_THROTTLED",e.INVALID_ORIGIN="INVALID_ORIGIN",e.INVALID_DIMENSIONS="INVALID_DIMENSIONS",e.INVALID_TITLE_LENGTH="INVALID_TITLE_LENGTH",e.INVALID_MESSAGE_DATA="INVALID_MESSAGE_DATA",e.MESSAGE_PROCESSING_FAILED="MESSAGE_PROCESSING_FAILED",e.UNSUPPORTED_MESSAGE_TYPE="UNSUPPORTED_MESSAGE_TYPE",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.DISPOSE_FAILED="DISPOSE_FAILED"}(t||(t={}));var _=function(){function e(){}return e.handle=function(e,t){e instanceof m?(n.Log.error(l,new Error("[".concat(t,"] ").concat(e.message," (Code: ").concat(e.code,")"))),e.originalError&&n.Log.error(l,e.originalError),this._logToTelemetry(e,t)):e instanceof Error?n.Log.error(l,new Error("[".concat(t,"] ").concat(e.message))):n.Log.error(l,new Error("[".concat(t,"] Unknown error: ").concat(String(e))))},e.warn=function(e,t,a){var i=a?"[".concat(t,"] ").concat(e," (Code: ").concat(a,")"):"[".concat(t,"] ").concat(e);n.Log.warn(l,i)},e.isErrorCode=function(e,t){return e instanceof m&&e.code===t},e.createError=function(e,t,n){return e instanceof Error?new m(e.message||n,t,e):new m(n,t)},e._logToTelemetry=function(e,t){p&&console.error("[Telemetry]",{error:e.message,code:e.code,context:t,timestamp:(new Date).toISOString()})},e}(),h=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}();const b=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._originalTitle="",t._lastInitTime=0,t._render=function(){var e;t._placeholder||(t._placeholder=t._tryCreatePlaceholder()),(null===(e=t._placeholder)||void 0===e?void 0:e.domElement)&&(t._container||t._createWolkvoxIframe())},t._onDispose=function(){n.Log.info(l,"Dispose"),t.onDispose()},t}return h(i,e),i.prototype.onInit=function(){return n.Log.info(l,"Initialized Wolkvox Chat Widget"),this._originalTitle=document.title,this._setupMessageListener(),this.context.placeholderProvider.changedEvent.add(this,this._render),this._render(),Promise.resolve()},i.prototype._setupMessageListener=function(){var e=this;this._messageListener=function(n){try{if(!e._isOriginAllowed(n.origin))return void _.warn("Message from unauthorized origin rejected: ".concat(n.origin),"MessageListener",t.INVALID_ORIGIN);if(!e._isValidMessageData(n.data))return void _.warn("Invalid message data type","MessageListener",t.INVALID_MESSAGE_DATA);e._handleMessage(n.data)}catch(e){_.handle(e,"MessageListener")}},window.addEventListener("message",this._messageListener)},i.prototype._isOriginAllowed=function(e){return-1!==o.ALLOWED_ORIGINS.indexOf(e)},i.prototype._isValidMessageData=function(e){return"string"==typeof e},i.prototype._handleMessage=function(e){this._isResizeMessage(e)&&this._handleResizeMessage(e),this._isStartMessage(e)&&this._initWolkvoxWidget(),this._isReopenMessage(e)&&(n.Log.info(l,"Chat reopened, reinitializing..."),this._initWolkvoxWidget()),this._isCloseMessage(e)&&this._handleChatClosed(),this._isTitleMessage(e)&&this._handleTitleNotification(e)},i.prototype._isResizeMessage=function(e){return-1!==e.indexOf(c)},i.prototype._isStartMessage=function(e){return-1!==e.indexOf("start")},i.prototype._isReopenMessage=function(e){return-1!==e.indexOf("restart")||-1!==e.indexOf("reopen")},i.prototype._isCloseMessage=function(e){return-1!==e.indexOf("close")||-1!==e.indexOf("closed")},i.prototype._isTitleMessage=function(e){return-1!==e.indexOf(d)},i.prototype._handleResizeMessage=function(e){if(this._iframe){var n=e.replace(c,"").split("||"),a=parseInt(n[0],10),i=parseInt(n[1],10);this._areDimensionsValid(a,i)?this._applyIframeDimensions(n):_.warn("Invalid dimensions: ".concat(a,"x").concat(i),"MessageListener:Resize",t.INVALID_DIMENSIONS)}},i.prototype._areDimensionsValid=function(e,t){return e<=o.MAX_DIMENSION_PX&&t<=o.MAX_DIMENSION_PX},i.prototype._applyIframeDimensions=function(e){if(this._iframe){var t=e[0],n=e[1],a=e[2],i=e[3];this._iframe.style.height=this._formatDimension(t),this._iframe.style.width=this._formatDimension(n),this._iframe.style.right=-1!==t.indexOf("%")?"0%":"".concat(a,"px"),this._iframe.style.bottom="".concat(i,"px")}},i.prototype._formatDimension=function(e){return-1!==e.indexOf("%")?e:"".concat(e,"px")},i.prototype._handleChatClosed=function(){n.Log.info(l,"Chat closed by user"),this._stopTitleNotifications(),document.title=this._originalTitle},i.prototype._stopTitleNotifications=function(){this._titleFlasher&&(clearInterval(this._titleFlasher),this._titleFlasher=void 0)},i.prototype._handleTitleNotification=function(e){var n=e.replace(d,"");this._isTitleLengthValid(n)?(this._stopTitleNotifications(),this._shouldFlashTitle(n)?this._startTitleFlashing(n):document.title=this._originalTitle):_.warn("Title too long: ".concat(n.length," chars"),"MessageListener:Title",t.INVALID_TITLE_LENGTH)},i.prototype._isTitleLengthValid=function(e){return e.length<=o.MAX_TITLE_LENGTH},i.prototype._shouldFlashTitle=function(e){return"("===e.charAt(0)&&") "===e.substring(e.length-2)},i.prototype._startTitleFlashing=function(e){var t=this;this._titleFlasher=window.setInterval(function(){document.title=e+" New Messages",setTimeout(function(){document.title=t._originalTitle},2e3)},4e3)},i.prototype._getButtonDimensions=function(){var e=this.properties.sizeBoton||"l";return s[e]||s.l},i.prototype._tryCreatePlaceholder=function(){return this.context.placeholderProvider.tryCreateContent(a.PlaceholderName.Bottom,{onDispose:this._onDispose})||this.context.placeholderProvider.tryCreateContent(a.PlaceholderName.Top,{onDispose:this._onDispose})},i.prototype._createWolkvoxIframe=function(){var e;if(null===(e=this._placeholder)||void 0===e?void 0:e.domElement){var t=this._buildIframeUrl(),n=this._getButtonDimensions();this._iframe=this._createIframeElement(t,n),this._setupIframeEventHandlers(),document.body.appendChild(this._iframe)}},i.prototype._buildIframeUrl=function(){var e=this.properties.baseUrlWolkvox||o.DEFAULT_BASE_URL,t=this.properties.operation||o.DEFAULT_OPERATION;return"".concat(e,"iframe.php?prodId=").concat(t)},i.prototype._createIframeElement=function(e,t){var n=document.createElement("iframe");return this._setIframeAttributes(n),this._setIframeStyles(n,t),n.src=e,n},i.prototype._setIframeAttributes=function(e){e.id=u,e.title=u,e.name=u,e.setAttribute("allow","microphone; autoplay"),e.setAttribute("sandbox","allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"),e.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),e.setAttribute("allowtransparency","true"),e.setAttribute("draggable","true"),e.frameBorder="0"},i.prototype._setIframeStyles=function(e,t){e.style.height=t.height,e.style.width=t.width,e.style.position="fixed",e.style.right="1%",e.style.bottom="1%",e.style.zIndex=o.IFRAME_Z_INDEX.toString(),e.style.overflow="hidden",e.style.border="none"},i.prototype._setupIframeEventHandlers=function(){var e=this;this._iframe&&(this._iframe.addEventListener("load",function(){n.Log.info(l,"Wolkvox iframe loaded successfully"),setTimeout(function(){e._initWolkvoxWidget()},o.INIT_DELAY_MS)}),this._setupIframeInteractionListener())},i.prototype._setupIframeInteractionListener=function(){var e=this;this._iframeClickListener=function(){Date.now()-e._lastInitTime>5e3&&n.Log.info(l,"User interacted with widget after long pause, checking if reinitialization needed")},window.addEventListener("blur",function(){document.activeElement===e._iframe&&e._iframeClickListener&&e._iframeClickListener()})},i.prototype._initWolkvoxWidget=function(){if(this._canInitializeWidget())if(this._shouldThrottleInitialization())n.Log.info(l,"Skipping initialization - too soon after last init");else{this._lastInitTime=Date.now();var e=this._buildInitializationData(),t=btoa(JSON.stringify(e));this._sendInitializationMessage(t)}},i.prototype._canInitializeWidget=function(){return this._iframe?!!this._iframe.contentWindow||(_.warn("Cannot initialize widget: iframe contentWindow not ready","InitWidget",t.IFRAME_CONTENT_WINDOW_NOT_READY),!1):(_.warn("Cannot initialize widget: iframe not found","InitWidget",t.IFRAME_NOT_FOUND),!1)},i.prototype._shouldThrottleInitialization=function(){return Date.now()-this._lastInitTime<o.THROTTLE_INTERVAL_MS},i.prototype._buildInitializationData=function(){var e={urlOrigen:btoa(window.location.host),sizeboton:this.properties.sizeBoton||"l",sizechat:this.properties.sizeChat||"l",fullscreen:this.properties.fullscreen||"0",idConfig:this.properties.idConfig||o.DEFAULT_ID_CONFIG,txt1:this.properties.txt1||"",txt2:this.properties.txt2||"",txt3:this.properties.txt3||"",txt4:this.properties.txt4||"",txt5:this.properties.txt5||"",txt6:this.properties.txt6||"",context:this.properties.context||"",height_mobile:this.properties.heightMobile||""};return n.Log.info(l,"Initialization data prepared for host: ".concat(window.location.host)),e},i.prototype._sendInitializationMessage=function(e){try{var t=this._getTargetOrigin();n.Log.info(l,"Sending initialization data to Wolkvox widget at origin: ".concat(t)),n.Log.info(l,"Encoded data length: ".concat(e.length," characters")),this._iframe.contentWindow.postMessage(e,t),n.Log.info(l,"Message sent successfully to ".concat(t))}catch(t){_.handle(t,"SendInitializationMessage"),this._handleInitializationError(t,e)}},i.prototype._getTargetOrigin=function(){var e=this.properties.baseUrlWolkvox||o.DEFAULT_BASE_URL;return new URL(e).origin},i.prototype._handleInitializationError=function(e,n){var a=_.createError(e,t.INIT_POSTMESSAGE_FAILED,"Failed to send initialization data to Wolkvox widget");_.handle(a,"InitWidget"),this._retryInitialization(n)},i.prototype._retryInitialization=function(e){var t=this;setTimeout(function(){var a;n.Log.info(l,"Retrying widget initialization...");try{if(null===(a=t._iframe)||void 0===a?void 0:a.contentWindow){var i=t._getTargetOrigin();t._iframe.contentWindow.postMessage(e,i)}}catch(e){_.handle(e,"InitWidget:Retry")}},o.RETRY_DELAY_MS)},i.prototype.onDispose=function(){try{this._cleanupMessageListener(),this._cleanupTitleNotifications(),this._cleanupIframe(),this._cleanupContainer(),n.Log.info(l,"Widget disposed successfully")}catch(e){_.handle(e,"Dispose")}},i.prototype._cleanupMessageListener=function(){this._messageListener&&(window.removeEventListener("message",this._messageListener),this._messageListener=void 0)},i.prototype._cleanupTitleNotifications=function(){this._stopTitleNotifications(),this._originalTitle&&(document.title=this._originalTitle)},i.prototype._cleanupIframe=function(){var e;(null===(e=this._iframe)||void 0===e?void 0:e.parentElement)&&(this._iframe.parentElement.removeChild(this._iframe),this._iframe=void 0)},i.prototype._cleanupContainer=function(){var e;(null===(e=this._container)||void 0===e?void 0:e.parentElement)&&this._container.parentElement.removeChild(this._container),this._container=void 0,this._placeholder=void 0},i}(a.BaseApplicationCustomizer)})(),r})());